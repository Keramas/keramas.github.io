---
layout: post
title: Square CTF - Dot-n-Dash
date: '2018-11-19T04:33:00.000-08:00'
author: Keramas
tags:
- CTF challenge
modified_time: '2018-11-19T04:33:28.996-08:00'
thumbnail: https://3.bp.blogspot.com/-EkenQlNMWHw/W_KoJyhJzGI/AAAAAAAAAuM/0qyvRfQbP_sWZ0_Fm7Tq5jh15aGXsyOhQCLcBGAs/s72-c/app.png
blogger_id: tag:blogger.com,1999:blog-4206503528938574504.post-8057148005187325338
blogger_orig_url: https://k3ramas.blogspot.com/2018/11/sqaure-ctf-dot-n-dash.html
---

This was a fun little programming challenge from the recent Square CTF.<br /><br />We are given an html file and an encoded 'instructions.txt' file, which is a cipher of sorts containing nothing but dots and dashes.<br /><br />Loading the html file shows that there is JavaScript running that can encode and decode text. Unfortunately, the developers never finished the decode function off, so it is up to us to find a way to decode the message.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-EkenQlNMWHw/W_KoJyhJzGI/AAAAAAAAAuM/0qyvRfQbP_sWZ0_Fm7Tq5jh15aGXsyOhQCLcBGAs/s1600/app.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="685" data-original-width="886" height="494" src="https://3.bp.blogspot.com/-EkenQlNMWHw/W_KoJyhJzGI/AAAAAAAAAuM/0qyvRfQbP_sWZ0_Fm7Tq5jh15aGXsyOhQCLcBGAs/s640/app.png" width="640" /></a></div><br /><br />Looking at the source code, we can get a better understanding of what is going on, and also strip away functions and play with the app to get a clearer picture.<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #111111; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">function encode() {<br />  var t = input.value;<br />  if (/^[-.]+$/.test(t)) {<br />    alert("Your text is already e'coded!");<br />  } else {<br />    input.value = _encode(t);<br />  }<br />  return false;<br />}<br /><br />function decode() {<br />  var t = input.value;<br />  if (/^[-.]*$/.test(t)) {<br />    input.value = _decode(t);<br />  } else {<br />    alert("Your text is not e'coded!");<br />  }<br />  return false;<br />}<br /><br />function _encode(input) {<br />  var a=[];<br />  for (var i=0; i &lt; input.length; i++) {<br />    var t = input.charCodeAt(i);<br />    for (var j=0; j<8 if="" j="" t="">&gt; j) &amp; 1) {<br />        a.push(1 + j + (input.length - 1 - i) * 8);<br />      }<br />    }<br />  }<br /><br />  var b = [];<br />  while (a.length) {<br />    var t = (Math.random() * a.length)|0;<br />    b.push(a[t]);<br />    a = a.slice(0, t).concat(a.slice(t+1));<br />  }<br /><br />  var r = '';<br />  while (b.length) {<br />    var t = b.pop();<br />    r = r + "-".repeat(t) + ".";<br />  }<br />  return r;<br />}<br /><br />// Everything below this line was lost due to cosmis radiation. The engineer who knows<br />// where the backups are stored already left.<br />function _decode(input) {<br />  return "";<br />}<br /></8></pre></div><br /><br />Trying to encode "a":<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-jpjrxKuwLiU/W_KoJ68It7I/AAAAAAAAAuU/3E4INrDqCbMr7Mve0XxaLSCopGzgUseQwCEwYBhgL/s1600/apptest1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="699" data-original-width="636" height="640" src="https://3.bp.blogspot.com/-jpjrxKuwLiU/W_KoJ68It7I/AAAAAAAAAuU/3E4INrDqCbMr7Mve0XxaLSCopGzgUseQwCEwYBhgL/s640/apptest1.png" width="580" /></a></div><br />Trying to encode "aa":<br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-nVNgg_zDEms/W_KoJyKsHgI/AAAAAAAAAuQ/5vfZpPje4Ucdyt53rmgdlUh9-RFfp8TxwCEwYBhgL/s1600/app2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="676" data-original-width="615" height="640" src="https://4.bp.blogspot.com/-nVNgg_zDEms/W_KoJyKsHgI/AAAAAAAAAuQ/5vfZpPje4Ucdyt53rmgdlUh9-RFfp8TxwCEwYBhgL/s640/app2.png" width="582" /></a></div><br /><br />Essentially what this code is doing is taking the input given, converting all characters in the string to a decimal value, and then determining which bits are active and creates an array based on the bit numbers that are a 1. The next part randomizes all of the numbers in the array, and then each number is represented by dashes equal to how large it is. Each number is delimited by dots.<br /><br />Now that we have this information, we can create a Python script to convert the encoded instructions.txt into an array.<br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #111111; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">stri = open("instructions.txt","r").read()<br />stri_list = stri.split('.')<br />a = []<br />for i in stri_list[:-1]:<br />    #print len(i)<br />    a.append(len(i))<br />print a<br /></pre></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-gh-uiZWKiHY/W_KsdjUC4lI/AAAAAAAAAus/Cpz6IXvR8jApIdHZsWvMLAJ_O2gI_z3iwCPcBGAYYCw/s1600/unsorted.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="627" data-original-width="826" height="483" src="https://1.bp.blogspot.com/-gh-uiZWKiHY/W_KsdjUC4lI/AAAAAAAAAus/Cpz6IXvR8jApIdHZsWvMLAJ_O2gI_z3iwCPcBGAYYCw/s640/unsorted.png" width="640" /></a></div><br /><br />While the encoder tries to make it tricky by randomizing all the numbers, the idea is that this is a very long binary string, and each "1" is being represented by a number in a total of 1296 bits, so we can sort the numbers easily. <br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-hkPWxm_Yz8g/W_Ksd9N8FHI/AAAAAAAAAu0/GGPdX5MGFnYvmxawJ8rLvABrNCT2e6BGgCPcBGAYYCw/s1600/sorted.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="621" data-original-width="819" height="483" src="https://4.bp.blogspot.com/-hkPWxm_Yz8g/W_Ksd9N8FHI/AAAAAAAAAu0/GGPdX5MGFnYvmxawJ8rLvABrNCT2e6BGgCPcBGAYYCw/s640/sorted.png" width="640" /></a></div><br /><br />Now it is just a matter of adding to our script to create a binary string with these numbers as the "1" and the other numbers as "0", and then convert that binary string to ASCII text. <br /><br /><!-- HTML generated using hilite.me --><br /><div style="background: #111111; border-width: 0.1em 0.1em 0.1em 0.8em; border: solid gray; overflow: auto; padding: 0.2em 0.6em; width: auto;"><pre style="line-height: 125%; margin: 0;">import binascii<br /><br />stri = open("instructions.txt","r").read()<br />stri_list = stri.split('.')<br />a = []<br />for i in stri_list[:-1]:<br />    #print len(i)<br />    a.append(len(i))<br /><br />print "Encoded array: "<br />print sorted(a, key=int)<br />print "\n"<br /><br />allbits = []<br />for bits in range(1,1297):<br />    allbits.append(bits)<br /><br />modbits = []<br />for i in allbits:<br />    if i in a and i in allbits:<br />        i=1<br />        modbits.append(i)<br />    else:<br />        i=0<br />        modbits.append(i)<br /><br />binstring = ''.join(str(e) for e in modbits)<br /><br />flag = int(binstring[::-1],2)<br />print binascii.unhexlify('%x' % flag)<br /></pre></div><br />Running the script and we get the flag!<br /><br /><a href="https://4.bp.blogspot.com/-Jq248Ie27_M/W_KsdujpONI/AAAAAAAAAuw/YHONtocqYSAnPx_vggwi3-d_jYuni1aggCPcBGAYYCw/s1600/flag.png" imageanchor="1"><img border="0" data-original-height="121" data-original-width="602" height="80" src="https://4.bp.blogspot.com/-Jq248Ie27_M/W_KsdujpONI/AAAAAAAAAuw/YHONtocqYSAnPx_vggwi3-d_jYuni1aggCPcBGAYYCw/s400/flag.png" width="400" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />