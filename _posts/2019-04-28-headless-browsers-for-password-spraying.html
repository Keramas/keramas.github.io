---
layout: post
title: Headless Browsers for Password Spraying
date: '2019-04-28T14:21:00.000-07:00'
author: Keramas
tags: 
modified_time: '2019-05-29T10:11:47.496-07:00'
thumbnail: https://4.bp.blogspot.com/-cDnAEgEhZ44/XMYTuxx5wmI/AAAAAAAAA34/M3-X_hlt21k5O7oKwlh7Wr7-zzZfd4VtwCLcBGAs/s72-c/generic_login_page.png
blogger_id: tag:blogger.com,1999:blog-4206503528938574504.post-120522218900349508
blogger_orig_url: https://k3ramas.blogspot.com/2019/04/headless-browsers-for-password-spraying.html
---

During a recent external penetration test, a client was using several Microsoft services, such as Outlook, Sharepoint, and Dynamics, wherein the logins all took place via 'login.microsoftonline.com'.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-cDnAEgEhZ44/XMYTuxx5wmI/AAAAAAAAA34/M3-X_hlt21k5O7oKwlh7Wr7-zzZfd4VtwCLcBGAs/s1600/generic_login_page.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="621" data-original-width="801" height="310" src="https://4.bp.blogspot.com/-cDnAEgEhZ44/XMYTuxx5wmI/AAAAAAAAA34/M3-X_hlt21k5O7oKwlh7Wr7-zzZfd4VtwCLcBGAs/s400/generic_login_page.png" width="400" /></a></div><br /><pic></pic>Often, inputting a corporate email here will redirect to a corporate ADFS page, but this is not always the case. In the situation I was found in where the authentication is taking place directly on the login.microsoftonline.com page, I was having issues password spraying since the determination of a success or failure was being done and displayed dynamically with JavaScript. Tools such as Burp Intruder and other command line spraying tools lack the functionality to render this JavaScript and check the DOM for success/failure, so it poses a hurdle for automated password spraying.<br /><br />After a bit of digging, a co-worker and I discovered a solution to this issue by using Python with a headless browser to make requests and search the DOM for indicators of success/failure.<br /><br />The following resource set us down the proper path:<br /><a href="https://realpython.com/modern-web-automation-with-python-and-selenium/">https://realpython.com/modern-web-automation-with-python-and-selenium/</a><br /><br />If you are familiar with how to use Beautiful Soup, then you shouldn't have any issues getting started, and the above guide provides all the information you need to have your script navigate the DOM.<br /><br />Using this concept and library, you can build out a password spray tool for each situation you find yourself in, it just takes a bit of manual probing to get the DOM elements correct and inserting the proper logic based on the page's functionality.<br /><br />To make password spraying possible and automated in these situations, my co-worker and I developed the following tool 'domspray' so we hope that it aids in any external penetration tests or red team engagements:<br /><br /><a href="https://github.com/km-zdh/domspray">https://github.com/km-zdh/domspray</a><br /><br /><br />As a parting note, if you are creating a script and running tests, be sure to properly close out the headless browser each time the script terminates or you are going to have a bad time! I can neither confirm nor deny why I know this...<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-Gs6Xfoi5cFg/XMYX2ke0JbI/AAAAAAAAA4Y/xixs2jlhXYQ4bCEiGZHF705mdIDEMUW3ACLcBGAs/s1600/chrome_ram.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="600" data-original-width="600" height="400" src="https://1.bp.blogspot.com/-Gs6Xfoi5cFg/XMYX2ke0JbI/AAAAAAAAA4Y/xixs2jlhXYQ4bCEiGZHF705mdIDEMUW3ACLcBGAs/s400/chrome_ram.jpg" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />